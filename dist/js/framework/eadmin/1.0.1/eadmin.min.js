/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function l(e,o){for(var n=0;n<o.length;n++){var l=o[n];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(e,o,n){return o&&l(e.prototype,o),n&&l(e,n),e}}();function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}var box=void 0,eadmin=function(){function e(){_classCallCheck(this,e),box=$("#container"),module.conf.allow_user_select||(userselect(0),selectEnabled=!1),module.conf.allow_right_click||disabledRight(),this.href="",this.currentHref="",this.boxScroll=null,this.jumpHref(),-1!=module.lib.indexOf("notice")&&($("body").append('<div id="notice"></div>'),$("#notice").css("top",module.conf.notice_top)),null!=module.conf.error_default_img&&""!=module.conf.error_default_img&&($("body").append('<img id="error-default-img" src="'+module.conf.error_default_img+'" class="dn">'),$("#error-default-img").on("error",function(){module.conf.error_default_img="",console.log("默认缺省图"+module.conf.error_default_img+" 不可用")})),module.conf.dblclick_goto_top&&box.on("dblclick",function(){var e=store("dblclick");"0"!==e&&("1"!==e?Popup.confirm({content:"是否同意开启双击回顶功能，本消息仅提示一次",callback:function(){store("dblclick","1"),Popup.success({content:"双击回顶设置成功",callback:function(){box.scrollTop(0)}})},cancel:function(){store("dblclick","0")}}):box.scrollTop(0))}),$("body").append('<div class="mask dn"></div>'),$("body").append('<div id="loading-progress"></div>')}return _createClass(e,[{key:"loadingProgress",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,o=$("#loading-progress");1!=e?o.stop().width(innerW()).animate({opacity:0}):o.css("opacity",1).animate({width:innerW()},1e4)}},{key:"mask",value:function(){var e=$(".mask");if(e.empty(),e.is(":hidden"))return e.show(),!1;var o=$(".window:visible").length;if(0<o){var n=9998+o;return e.css("z-index",n),n}return!1}},{key:"maskHide",value:function(){var e=[$(".mask"),$(".window:visible").length],o=e[0];0<e[1]?o.css("z-index","-=1"):o.css("z-index",9998).hide()}},{key:"homepage",value:function(){var e=this;if(box.height(innerH()-$("header").outerHeight()-30),null!=module.conf&&null!=module.conf.homepage&&""!=module.conf.homepage){this.loadingProgress();var o=getRoute();o?(e.href=o,e.currentHref=o):(o=module.conf.homepage,store.remove("main_nav_id"),store.remove("sub_nav_id")),null!=module.conf.load_page_timeout&&0<module.conf.load_page_timeout?setTimeout(function(){box.load(o,function(){e.load()})},module.conf.load_page_timeout):box.load(o,function(){e.load()})}}},{key:"jumpHref",value:function(){if(!1!==module.conf.homepage&&0==box.length)return console.log("没有找到id为container的容器div，请检查!"),!1;var i=this;$("body").on("click","a:not(.ql-action), button.href",function(){var e={this:$(this),subnav:$(".sub-nav")};if(e.href=e.this.attr("href"),i.href=i.currentHref=e.href,e.this.hasClass("nav"))if(addClassExc(e.this,"active"),e.id=e.this.data("id"),e.sub=window.nav[e.id].sub,store("main_nav_id",e.id.toString()),null==e.sub){if(null==window.nav[e.id].href)return console.log("当前分类既没有子分类，也没有指定链接"),!1;$(".sub-nav div").eq(1).empty()}else{for(var o in e.navHtml="<ul>",e.sub)e.navHtml+='<a href="'+e.sub[o].href+'" data-id="'+o+'"',null!=e.sub[o].native?e.navHtml+=' data-native target="_blank">':(e.navHtml+=' class="nav-sub"',null!=e.sub[o].container&&(navHtml+=' data-container="'+e.sub[o].container+'"'),e.navHtml+=">"),e.navHtml+="<li>",null!=e.sub[o].icon&&""!=e.sub[o].icon&&(e.navHtml+='<i class="'+e.sub[o].icon+'"></i>'),e.navHtml+=e.sub[o].name,e.navHtml+="</li></a>";if(e.navHtml+="</ul>",e.subnav.show().children("div").eq(1).html(e.navHtml),null!=module.conf.auto_click_sub_nav&&module.conf.auto_click_sub_nav){if(null!=e.sub[0].native)return;return e.subnav.find("a:first").trigger("click"),store("sub_nav_id","0"),!1}}else e.this.hasClass("nav-sub")&&(addClassExc(e.this,"active"),store("sub_nav_id",e.this.data("id").toString()));if("javascript:;"==i.href||null!=e.this.data("native"))return!0;setRoute(i.href);var n=md5(i.href);store.remove(n+"_page");var l=e.this.data("container");return l=!!l&&"#"+l,i.refresh(l),!1})}},{key:"refresh",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],o=this,l=e?$(e):box;l.empty(),this.loadingProgress();var n=[".window",".datepicker",".citypicker",".dz-hidden-input",".dropdown:not(.fixed)"];for(var i in n)$(n[i]).remove();0<Mount.dropzone.length&&(_.each(Mount.dropzone,function(e){e.disable()}),Mount.dropzone=[]),Mount.window=null,setTimeout(function(){Method={},o.href=""==o.href?module.conf.homepage:o.href,$(window).off(),l.off().load(o.href,function(){if(o.load(),"#right-frame"==e){var n='<div class="contents"><ul>';l.find("h2").each(function(e){$(this).attr("id","h2-"+e);var o=$(this).html();n+="<li>"+o+"</li>"}),n+="</ul></div>",l.append(n),$("code").each(function(){var e={this:$(this)};if(e.html=e.this.html(),e.html=e.html.replace(/[<>]/g,function(e){return{"<":"&lt;",">":"&gt;"}[e]}),e.html=e.html.replace(/^\s+|\s+$/g,""),e.this.html(e.html),!e.this.hasClass("hljs"))return!0;hljs.highlightBlock(e.this[0]),hljs.lineNumbersBlock(e.this[0])})}})},module.conf.load_page_timeout)}},{key:"nav",value:function(){if(!1!==module.conf.homepage){var o=function(e){var o="<ul>",n=0,l=store("main_nav_id");for(var i in e){var t="";null==l?0==n&&(t=" active"):i==l&&(t=" active"),o+='<a href="'+(null==e[i].sub?e[i].href:"javascript:;")+'"',null==e[i].native?(o+='class="nav'+t+'" data-id="'+i+'"',null!=e[i].container&&(o+=' data-container="'+e[i].container+'"'),o+=">"):o+=' data-native target="_blank">',o+="<li>"+e[i].name+'<div class="nav-slider"></div></li></a>',n++}if(o+="</ul>",$(".nav").html(o),null!=l){var r=window.nav[l].sub;if(null!=r){o="<ul>";var a=store("sub_nav_id");for(var u in r)o+='<a href="'+r[u].href+'" data-id="'+u+'"',null!=r[u].native?o+=' data-native target="_blank">':(o+=' class="nav-sub',u==a&&(o+=" active"),o+='">'),o+="<li>",null!=r[u].icon&&""!=r[u].icon&&(o+='<i class="'+r[u].icon+'"></i>'),o+=r[u].name,o+="</li></a>";o+="</ul>",$(".sub-nav").show().children("div").eq(1).html(o)}}};"local"!=module.conf.nav_data_source?""!=module.conf.nav_api_url?this.get({url:module.conf.nav_api_url,then:function(e){window.nav=e,o(e)}}):console.log("导航接口地址不能为空，导航创建失败"):loader.load(_ROOTPATH+"js/data/nav.js",function(){o(window.nav)})}}},{key:"load",value:function(){null!=this.boxScroll&&(this.boxScroll.destroy(),this.boxScroll=null),this.loadingProgress(0),defaultImg(box),block(box),this.form(),Button.run(box),-1!=module.lib.indexOf("tag")&&Tag.run(box),this.onscroll();var e=$("body").find(".iscroll");if(0<e.length){var o=this;e.each(function(){o.scroll($(this)[0])})}this.boxScroll=this.scroll(box[0]),-1!=module.lib.indexOf("progress")&&Progress.run(box)}},{key:"scroll",value:function(e){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"y",n={wheelPropagation:"y"!=o};return"y"==o?n.suppressScrollX=!0:n.suppressScrollY=!0,new PerfectScrollbar(e,n)}},{key:"form",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return Form.init(e),this}},{key:"datepicker",value:function(e,o){if(-1!=module.lib.indexOf("datepicker"))return new Datepikcer(e,o),this;console.log("请先在lib中加载datepicker组件")}},{key:"citypicker",value:function(e,o){if(-1!=module.lib.indexOf("citypicker"))return new Citypikcer(e,o),this;console.log("请先在lib中加载citypicker组件")}},{key:"window",value:function(e,o){if(-1!=module.lib.indexOf("window"))return new Window(e,o),this;console.log("请先在lib中加载window组件")}},{key:"slider",value:function(e,o){if(-1!=module.lib.indexOf("slider"))return new Slider(e,o),this;console.log("请先在lib中加载slider组件")}},{key:"transfer",value:function(e,o){if(-1!=module.lib.indexOf("transfer"))return new Transfer(e,o),this;console.log("请先在lib中加载transfer组件")}},{key:"rate",value:function(e,o){if(-1!=module.lib.indexOf("rate"))return new Rate(e,o),this;console.log("请先在lib中加载rate组件")}},{key:"colorpicker",value:function(e,o){if(-1!=module.lib.indexOf("colorpicker"))return new Colorpicker(e,o),this;console.log("请先在lib中加载colorpicker组件")}},{key:"table",value:function(e,o){if(-1!=module.lib.indexOf("table"))return new Table(e,o);console.log("请先在lib中加载table组件")}},{key:"page",value:function(e){if(-1!=module.lib.indexOf("page"))return new Page(e),this;console.log("请先在lib中加载page组件")}},{key:"upload",value:function(e,o){if(-1!=module.lib.indexOf("upload"))return new Upload(e,o),this;console.log("请先在lib中加载upload组件")}},{key:"chart",value:function(e,o){if(-1!=module.lib.indexOf("chart"))return new EChart(e,o),this;console.log("请先在lib中加载chart组件")}},{key:"tree",value:function(e,o){if(-1!=module.lib.indexOf("tree"))return new Tree(e,o),this;console.log("请先在lib中加载tree组件")}},{key:"tab",value:function(e,o){if(-1!=module.lib.indexOf("tab"))return new Tab(e,o),this;console.log("请先在lib中加载tab组件")}},{key:"editor",value:function(e,o){if(-1!=module.lib.indexOf("editor"))return new Editor(e,o),this;console.log("请先在lib中加载editor组件")}},{key:"dropdown",value:function(e,o){if(-1!=module.lib.indexOf("dropdown"))return new Dropdown(e,o),this;console.log("请先在lib中加载dropdown组件")}},{key:"template",value:function(l){function e(e,o,n){return l.apply(this,arguments)}return e.toString=function(){return l.toString()},e}(function(e,o,n){try{template;var l={html:template(e,o),box:scope('[data-template="'+e+'"]')};if(0==l.box.length)return void console.log('没有找到对应的模版容器 data-template="'+e+'"，渲染失败');l.box.html(l.html),_.isFunction(n)&&n()}catch(e){console.log(e)}})},{key:"request",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o=$("#"+Mount.window+"_query");if(0==o.length)return{};var n=o.val();return""==n?{}:(n=JSON.parse(n),""==e?n:n[e])}},{key:"onscroll",value:function(){var o=[".datepicker",".citypicker",".dropdown"];box.on("scroll",function(){if(clear){for(var e in o)$(o[e]).hide();$(":focus").trigger("blur"),clear=!1}})}},{key:"get",value:function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};null!=i.url?(null==i.param&&(i.param={}),axios.get(i.url,{params:i.param}).then(function(e){var o=void 0;if(null!=(o=_.isFunction(module.conf.http.response)?module.conf.http.response(e.data):e.data)[module.conf.http.code_field]){var n="";if(null!=o[module.conf.http.msg_field]&&(n=o[module.conf.http.msg_field]),null!=o[module.conf.http.data_field]){if(o[module.conf.http.code_field]!=module.conf.http.code_success)return""==n&&(n="操作执行失败"),Message.error({content:n}),void(_.isFunction(i.error)&&i.error());if(!0===i.popup){var l={content:n=n||"操作执行成功"};_.isFunction(i.then)&&(l.callback=function(){i.then(o)}),Popup.success(l)}else _.isFunction(i.then)&&i.then(o[module.conf.http.data_field])}else console.log("接口返回结果中没有找到定义的数据体字段")}else console.log("接口返回结果中没有找到定义的code码字段")}).catch(function(e){console.log(e)})):console.log("请指定接口地址")}},{key:"post",value:function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};null!=i.url?null!=i.form?axios.post(i.url,i.form,module.conf.http.headers).then(function(e){var o=void 0;if(null!=(o=_.isFunction(module.conf.http.response)?module.conf.http.response(e.data):e.data)[module.conf.http.code_field]){var n="";if(null!=o[module.conf.http.msg_field]&&(n=o[module.conf.http.msg_field]),o[module.conf.http.code_field]!=module.conf.http.code_success)return n=n||"操作执行失败",Message.error({content:n}),void(_.isFunction(i.error)&&i.error(o));_.isFunction(i.close)&&i.close();var l={content:n=n||"操作执行成功"};_.isFunction(i.then)&&(l.callback=function(){i.then(o)}),Popup.success(l)}else console.log("接口返回结果中没有找到定义的code码字段")}).catch(function(e){console.log(e),_.isFunction(i.error)&&i.error()}):console.log("请指定需要提交的POST数据"):console.log("请指定接口地址")}}]),e}(),Eadmin=new eadmin;loader.ready(function(){Mount.skin=-1==body.css("background-color").indexOf(245)?"dark":"light",null!=module.framework.chart&&(Chart.defaults.fontColor="#FFF",Chart.defaults.scale.gridLines.color="#151935"),null!=module.framework.axios&&_.each(module.conf.http,function(e,o){axios.defaults[o]=e}),-1!=module.plugin.indexOf("dropzone")&&(Dropzone.autoDiscover=!1),Eadmin.nav(),Eadmin.homepage(),-1!=module.lib.indexOf("tips")&&Tips.run(),-1!=module.lib.indexOf("popup")&&(Eadmin.popup=Popup),-1!=module.lib.indexOf("message")&&(Eadmin.message=Message),-1!=module.lib.indexOf("notice")&&(Eadmin.notice=Notice),-1!=module.lib.indexOf("button")&&(Eadmin.button=Button,Button.event()),-1!=module.lib.indexOf("form")&&Form.event(),-1!=module.lib.indexOf("validate")&&Validate.run(),-1!=module.lib.indexOf("imageview")&&Imageview.run(),module.conf.window_close_by_shade&&$(".mask").on("click",function(){0!=$(".window").length&&$(".window:last").children(".window-close").trigger("click")})});