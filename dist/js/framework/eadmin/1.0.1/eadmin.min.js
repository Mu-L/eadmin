/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function a(e,n){for(var i=0;i<n.length;i++){var a=n[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,n,i){return n&&a(e.prototype,n),i&&a(e,i),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var box=void 0,eadmin=function(){function e(){_classCallCheck(this,e),box=$("#container"),module.conf.allow_select_text||(selectText(0),selectEnabled=!1),module.conf.allow_right_click||disabledRight(),this.href="",this.currentHref="",this.boxScroll=null,this.jumpHref(),-1!=module.lib.indexOf("notice")&&($("body").append('<div id="notice"></div>'),$("#notice").css("top",module.conf.notice_top)),$("header").after('<div class="mobile-nav"></div>').append('<i class="ri-menu-line mobile-menu"></i>'),$("body").on("click",".mobile-menu",function(){var e={this:$(this)};null==e.this.data("open")?(e.this.addClass("ri-close-line").removeClass("ri-menu-line").data("open",1),$(".mobile-nav").show()):(e.this.addClass("ri-menu-line").removeClass("ri-close-line").removeData("open"),$(".mobile-nav").hide())})}return _createClass(e,[{key:"loading",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";this.mask(),$(".mask").html('<i class="ri-loader-4-line rotate"></i>'+(""==e?"页面加载中，请稍候...":e))}},{key:"loadingHide",value:function(){Mount.page||this.maskHide()}},{key:"mask",value:function(){0==$(".mask").length&&$("body").append('<div class="mask"></div>');var e=$(".mask");if(e.empty(),e.is(":hidden"))return e.show(),!1;var n=$(".window:visible").length;if(0<n){var i=9998+n;return e.css("z-index",i),i}return!1}},{key:"maskHide",value:function(){var e=$(".mask");0<$(".window:visible").length?e.css("z-index","-=1"):e.hide()}},{key:"homepage",value:function(){var e=this;if(box.height(innerH()-$("header").outerHeight()-40),null!=module.conf&&null!=module.conf.homepage&&""!=module.conf.homepage){this.loading();var n=getRoute();n||(n=module.conf.homepage,store.remove("main_nav_id"),store.remove("sub_nav_id")),null!=module.conf.load_page_timeout&&0<module.conf.load_page_timeout?setTimeout(function(){box.load(n,function(){e.load()})},module.conf.load_page_timeout):box.load(n,function(){e.load()})}}},{key:"jumpHref",value:function(){if(!1!==module.conf.homepage&&0==box.length)return console.log("没有找到id为container的容器div，请检查!"),!1;var a=this;$("body").on("click","a:not(.ql-action)",function(){var e={this:$(this),subnav:$(".sub-nav")};if(e.this.hasClass("active"))return!1;if(a.href=e.this.attr("href"),a.currentHref=a.href,e.this.hasClass("nav"))if(addClassExc(e.this,"active"),e.id=e.this.data("id"),e.sub=window.nav[e.id].sub,store("main_nav_id",e.id.toString()),null==e.sub){if(null==window.nav[e.id].href)return console.log("当前分类既没有子分类，也没有指定链接"),!1;$(".sub-nav div").eq(1).empty()}else{for(var n in e.navHtml="<ul>",e.sub)e.navHtml+='<a href="'+e.sub[n].href+'" data-id="'+n+'"',null!=e.sub[n].native?e.navHtml+=' data-native target="_blank">':e.navHtml+=' class="nav-sub">',e.navHtml+="<li>",null!=e.sub[n].icon&&""!=e.sub[n].icon&&(e.navHtml+='<i class="'+e.sub[n].icon+'"></i>'),e.navHtml+=e.sub[n].name,e.navHtml+="</li></a>";if(e.navHtml+="</ul>",e.subnav.show().children("div").eq(1).html(e.navHtml),null!=module.conf.auto_click_sub_nav&&module.conf.auto_click_sub_nav){if(null!=e.sub[0].native)return;return e.subnav.find("a:first").trigger("click"),store("sub_nav_id","0"),!1}}else e.this.hasClass("nav-sub")&&(addClassExc(e.this,"active"),store("sub_nav_id",e.this.data("id").toString()));if("javascript:;"==a.href||null!=e.this.data("native"))return!0;setRoute(a.href);var i=md5(a.href);return store.remove(i+"_page"),a.refresh(),!1})}},{key:"refresh",value:function(){var e=this;box.empty(),e.loading();var n=[".window",".datepicker",".citypicker",".dz-hidden-input"];for(var i in n)$(n[i]).remove();0<Mount.dropzone.length&&(_.each(Mount.dropzone,function(e){e.disable()}),Mount.dropzone=[]),Mount.window=null,Mount.data=null,setTimeout(function(){Method={},e.href=""==e.href?module.conf.homepage:e.href,box.off().load(e.href,function(){e.load()})},module.conf.load_page_timeout)}},{key:"nav",value:function(){if(!1!==module.conf.homepage){var n=function(e){var n="<ul>",i="<ul>",a=0,t=store("main_nav_id");for(var o in e){var l=null==e[o].sub?e[o].href:"javascript:;",r="";null==t?0==a&&(r=" active"):o==t&&(r=" active"),n+='<a href="'+l+'"',i+='<a href="'+l+'"',null==e[o].native?(n+='class="nav'+r+'" data-id="'+o+'">',i+='class="nav'+r+'" data-id="'+o+'">'):(n+=' data-native="1" target="_blank">',i+=' data-native="1" target="_blank">'),n+="<li>"+e[o].name+'<div class="nav-slider"></div></li></a>',i+="<li>"+e[o].name,null!=e[o].sub&&(i+='<i class="ri-arrow-down-s-line"></i>'),i+="</li></a>",a++}if(n+="</ul>",i+="</ul>",$(".nav").html(n),$(".mobile-nav").html(i),null!=t){var u=window.nav[t].sub;if(null!=u){n="<ul>";var s=store("sub_nav_id");for(var c in u)n+='<a href="'+u[c].href+'" data-id="'+c+'"',null!=u[c].native?n+=' data-native target="_blank">':(n+=' class="nav-sub',c==s&&(n+=" active"),n+='">'),n+="<li>",null!=u[c].icon&&""!=u[c].icon&&(n+='<i class="'+u[c].icon+'"></i>'),n+=u[c].name,n+="</li></a>";n+="</ul>",$(".sub-nav").show().children("div").eq(1).html(n)}}};"local"!=module.conf.nav_data_source?""!=module.conf.nav_api_url?axios.get(module.conf.nav_api_url).then(function(e){window.nav=e.data,n(e.data)}).catch(function(e){console.log(e)}):console.log("导航接口地址不能为空，导航创建失败"):loader.load(_ROOTPATH+"data/nav.js",function(){n(window.nav)})}}},{key:"load",value:function(){null!=this.boxScroll&&(this.boxScroll.destroy(),this.boxScroll=null),this.loadingHide(),this.form(),Button.run(box),Status.run(box),Tag.run(box),Progress.run(box),this.onscroll();var e=$("body").find(".iscroll");if(0<e.length){var n=this;e.each(function(){n.scroll($(this)[0])})}this.boxScroll=this.scroll(box[0]),block(box)}},{key:"scroll",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"y",i={wheelPropagation:"y"!=n};return"y"==n?i.suppressScrollX=!0:i.suppressScrollY=!0,new PerfectScrollbar(e,i)}},{key:"form",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return Form.init(e),this}},{key:"datepicker",value:function(e,n){return new Datepikcer(e,n),this}},{key:"citypicker",value:function(e,n){return new Citypikcer(e,n),this}},{key:"window",value:function(e,n){var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];return new Window(e,n,i),this}},{key:"slider",value:function(e,n){return new Slider(e,n),this}},{key:"transfer",value:function(e,n){return new Transfer(e,n),this}},{key:"rate",value:function(e,n){return new Rate(e,n),this}},{key:"colorpicker",value:function(e,n){return new Colorpicker(e,n),this}},{key:"table",value:function(e,n){return new Table(e,n),this}},{key:"page",value:function(e){return new Page(e),this}},{key:"upload",value:function(e,n){return new Upload(e,n),this}},{key:"chart",value:function(e,n){return new EChart(e,n),this}},{key:"tree",value:function(e,n){return new Tree(e,n),this}},{key:"tab",value:function(e,n){return new Tab(e,n),this}},{key:"editor",value:function(e,n){return new Editor(e,n),this}},{key:"template",value:function(a){function e(e,n,i){return a.apply(this,arguments)}return e.toString=function(){return a.toString()},e}(function(e,n,i){try{template;var a={html:template(e,n),box:scope('[data-template="'+e+'"]')};if(0==a.box.length)return void console.log('没有找到对应的模版容器 data-template="'+e+'"，渲染失败');a.box.html(a.html),_.isFunction(i)&&i()}catch(e){console.log(e)}})},{key:"onscroll",value:function(){var n=[".datepicker",".citypicker"];box.on("scroll",function(){if(clear){for(var e in n)$(n[e]).hide();$(":focus").blur(),clear=!1}})}}]),e}(),Eadmin=new eadmin;loader.ready(function(){null!=module.framework.chart&&(Chart.defaults.fontColor="#FFF",Chart.defaults.scale.gridLines.color="#151935"),null!=module.framework.axios&&_.each(module.conf.http,function(e,n){axios.defaults[n]=e}),-1!=module.plugin.indexOf("dropzone")&&(Dropzone.autoDiscover=!1),Eadmin.nav(),Eadmin.homepage(),-1!=module.lib.indexOf("tips")&&Tips.run(),-1!=module.lib.indexOf("popup")&&(Eadmin.popup=Popup),-1!=module.lib.indexOf("message")&&(Eadmin.message=Message),-1!=module.lib.indexOf("notice")&&(Eadmin.notice=Notice),-1!=module.lib.indexOf("button")&&(Eadmin.button=Button,Button.event()),-1!=module.lib.indexOf("form")&&Form.event(),-1!=module.lib.indexOf("validate")&&Validate.run(),module.conf.window_close_by_shade&&$(".mask").on("click",function(){0!=$(".window").length&&$(".window:last").children(".window-close").trigger("click")})});