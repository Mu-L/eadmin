/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Citypikcer=function(){function i(e,t){if(_classCallCheck(this,i),"undefined"==typeof city_data_init)return console.log("没有检测到城市选择器必须的城市数据"),!1;this.input=e,this.inputDom=scope(this.input),this.picker=null,this.index=0,this.scrollTop=0,this.init=!1,this.level=1,this.prov=0;if(this.param=$.extend({type:1,format:" / ",level:3,change:null},t),0==this.inputDom.length)return console.log("当前页面中不包含"+this.input+"元素，创建失败"),!1;this.run()}return _createClass(i,[{key:"run",value:function(){this._create(),this._event()}},{key:"_create",value:function(){var e=createId(),t='<div id="citypicker-'+e+'" class="citypicker animated faster'+(null==Mount.window?"":" "+Mount.window)+'"';1==this.param.type?(t+=' style="width:472px;">',t+='<span class="title">Tips：输入城市拼音首字母可快速选择，例如：hf</span>\n\t\t\t<div class="header">\n\t\t\t\t<span class="current">热门</span>\n\t\t\t\t<span>ABC</span>\n\t\t\t\t<span>DEF</span>\n\t\t\t\t<span>GHI</span>\n\t\t\t\t<span>JKL</span>\n\t\t\t\t<span>MNO</span>\n\t\t\t\t<span>PQR</span>\n\t\t\t\t<span>STU</span>\n\t\t\t\t<span>VWX</span>\n\t\t\t\t<span>YZ</span>\n\t\t\t</div>\n\t\t\t<div class="body"></div>\n\t\t\t<div class="quick iscroll dn"></div>'):t+='><div class="vert iscroll"></div>',t+="</div>",body.append(t),this.picker=$("#citypicker-"+e),2==this.param.type&&this.picker.css("padding","5px")}},{key:"_event",value:function(){var n=this,e=[".header span:not(.current):not(.not-allow)",".body span, .quick span",".vert span"],t=[n.picker.children(".body"),n.picker.children(".quick")],a=t[0],l=t[1];1!=n.param.type&&(a=n.picker.children(".vert")),this.inputDom.on("focus",function(){n.init||(n._formatData(a),n.init=!0),fadeIn(n.picker,$(this),!1),clear=!0}).on("blur",function(){n.focus||(fadeOut(n.picker),clear=!1)}),keyup(this.inputDom,function(e,t){var i={val:e.val(),key:t.keyCode,html:""};if(1==n.param.type)return""!=i.val&&(64<i.key&&i.key<91||8==i.key||32==i.key)?(n.picker.is(":hidden")&&fadeIn(n.picker,e,!1),l.is(":hidden")&&(n.picker.data("left",n.picker.css("left")).css("left",e.offset().left).width(158).children(".title").html(" ↑ ↓ 键快速选择城市"),n.picker.children(".header, .body").hide(),l.show()),$.each(cp_b,function(e,t){-1!=t.indexOf(i.val)&&(t=t.split("@"),i.html+="<span>"+t[0]+"</span>")}),void l.html(i.html)):void(""==i.val&&n._reset());n.level=1,a.eq(0).nextAll(".vert").remove(),""!=i.val?(i.html=i.icon="",2==n.param.type&&1<n.param.level&&(i.icon='<i class="ri-arrow-right-s-line"></i>'),$.each(cp_d,function(e,t){-1!=t.indexOf(i.val)&&(t=t.split("@"),i.html+='<span data-c="'+t[0]+'" data-i="'+e+'">'+t[0]+i.icon+"</span>")}),a.eq(0).html(i.html)):n._formatData(a)}),1==n.param.type&&n.inputDom.on("keydown",function(e){var t;-1==_.indexOf([13,38,40],e.keyCode)||l.is(":hidden")||(t=l.children("span"),13!=e.keyCode?(38==e.keyCode&&(n.index<0&&(n.index=t.length-1),--n.index),40==e.keyCode&&(n.index!=t.length-1&&0!=l.children(".current").length||(n.index=-1),n.index+=1),n.index<0&&(n.scrollTop=l[0].scrollHeight-l.height(),l.scrollTop(n.scrollTop)),0==n.index&&(n.scrollTop=0,l.scrollTop(0)),t.eq(n.index).addClass("current").siblings().removeClass("current"),200<(e=t.eq(n.index).position().top)&&0<=n.index?(n.scrollTop+=215,l.scrollTop(n.scrollTop)):e<=0&&(n.scrollTop-=215,l.scrollTop(n.scrollTop))):n._setVal(t.eq(n.index).html()))}),n.picker.on("blur",function(){n.inputDom.blur(),fadeOut(n.picker),clear=!1}).on("click",e[0],function(){var e=$(this);addClassExc(e,"current"),n._formatData(a,cp_a[e.index()])}).on("click",e[1],function(){n._setVal($(this).html())}).on("click",e[2],function(){var e=[$(this),{}],t=e[0],i=e[1];if(i.val=t.data("c"),1!=n.param.level){if(addClassExc(t,"current"),i.parent=t.parent(),n.level=i.parent.index()+1,n.level==n.param.level)return i.val=i.doc="",n.picker.find(".current").each(function(){i.val+=i.doc+$(this).data("c"),i.doc=n.param.format}),void n._setVal(i.val);i.parent.nextAll(".vert").remove(),i.index=t.data("i"),i.next=i.parent.next(".vert"),0==i.next.length&&(n.level+=1,n.picker.append('<div class="vert"></div>'),i.next=n.picker.children(".vert:last"),Eadmin.scroll(i.next[0])),i.source=null,2==n.level?(n.prov=i.index,i.source=cp_c[i.index].sub):i.source=cp_c[n.prov].sub[i.index].sub,n._formatData(i.next,i.source,!0)}else n._setVal(i.val)}).on("mousedown",function(e){e.preventDefault()})}},{key:"_formatData",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=void 0;if(null!=t)if(i=[],2<arguments.length&&void 0!==arguments[2]&&arguments[2])for(var n in t)i[n]=t[n].name;else i=t;else if(1==this.param.type)i=cp_a[0];else for(var a in i=[],cp_c)i[a]=cp_c[a].name;var l,r="",s="";for(l in 2==this.param.type&&this.level<this.param.level&&(s='<i class="ri-arrow-right-s-line"></i>'),i)r+='<span data-c="'+i[l]+'" data-i="'+l+'">'+i[l]+s+"</span>";e.html(r)}},{key:"_setVal",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";this.inputDom.val(t),this.focus=!1,this.picker.trigger("blur"),this._callback(t),2!=this.param.type&&(this.picker.children(".quick").is(":hidden")||setTimeout(function(){e._reset()},500))}},{key:"_reset",value:function(){this.picker.width(450).children(".title").html("Tips：输入城市拼音首字母可快速选择，例如：hf"),null!=this.picker.data("left")&&this.picker.css("left",this.picker.data("left")),this.picker.children(".header, .body").show(),this.picker.children(".quick").hide()}},{key:"_callback",value:function(e){_.isFunction(this.param.change)&&this.param.change(e)}}]),i}();