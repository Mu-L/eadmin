/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function l(t,e){for(var a=0;a<e.length;a++){var l=e[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}return function(t,e,a){return e&&l(t.prototype,e),a&&l(t,a),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Form=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"init",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:null)||box,t=e.find('input[type="text"]');module.conf.close_autocomplete&&t.attr("autocomplete","off"),t.each(function(){var t=$(this),e={class:"icon-input",numinput:t.hasClass("num-input")};if(e.icon=t.data("icon"),null==e.icon||e.numinput||(-1!=e.icon.indexOf("|")&&(e.arr=e.icon.split("|"),e.icon=e.arr[0],e.class="right"==e.arr[1]?e.class+"-right":e.class),t.parent().is("label")?(t.before('<i class="'+e.icon+'"></i>'),t.parent().addClass(e.class)):(t.before('<label class="'+e.class+'"></label>'),e.label=t.prev("label"),$('<i class="'+e.icon+'"></i>').appendTo(e.label),t.appendTo(e.label))),e.prepend=t.data("prepend"),null!=e.prepend){var a='<div class="input-group">\n\t\t\t\t\t\t\t\t<span class="prepend">'+e.prepend+"</span>\n\t\t\t\t\t\t\t</div>";t.before(a),t.appendTo(t.prev(".input-group"))}if(e.append=t.data("append"),null!=e.append){if(!t.parent().is(".input-group")){t.before('<div class="input-group"></div>'),t.appendTo(t.prev(".input-group"))}$('<span class="append">'+e.append+"</span>").appendTo(t.parent())}if(e.numinput&&(""==t.val()?(t.val(0),e.val=0):e.val=t.val(),e.min=t.data("min")||0,e.max=t.data("max")||0,e.add=0<e.max&&e.val>=e.max?"disabled":"",e.cut=e.val<=e.min?"disabled":"",e.html='<span class="num-add-cut">\n\t\t\t\t\t\t\t<i class="ri-arrow-up-s-line add '+e.add+'"></i>\n\t\t\t\t\t\t\t<i class="ri-arrow-down-s-line cut '+e.cut+'"></i>\n\t\t\t\t\t\t</span>',t.before('<div class="input-group"></div>'),e.group=t.prev(".input-group"),t.appendTo(e.group),$(e.html).appendTo(e.group)),e.date=t.data("default-date"),null!=e.date&&0==t.next("input").length){var l=t.attr("name");null!=l?t.removeAttr("name").after('<input type="hidden" name="'+l+'" value="'+e.date+'">'):console.log("没有为日期文本框指定name属性，这将影响后端取值")}}),e.find("textarea[maxlength]").each(function(){var t=$(this),e=[t.attr("maxlength"),t.text().length],a='<span class="font-num">'+e[1]+" / "+e[0]+"</span>";t.addClass("no-resize textarea-max").after(a)});var a=e.find("select:not([class^='ql-'])");0<a.length&&a.each(function(){var t=$(this),c={li:"",default:"",multiple:t.data("multiple"),disabled:"",class:"",index:t.find(":selected").index(),selected:null,txtArr:[]};null!=c.multiple&&(c.name=t.attr("name"),null==c.name&&console.log("下拉菜单上没有指定name,后端无法取值"),c.default=t.data("selected")||"",t.removeAttr("name").before('<input type="hidden" name="'+c.name+'" value="'+c.default+'">'),c.default=c.default.split(",")),t.is(":disabled")&&(c.disabled=" select-disabled"),c.class=0==c.index||""!=c.disabled?"":"selected",c.bind=t.data("bind"),null!=c.bind&&(c.child=e.find("#"+c.bind),0==c.child.length?console.log("没有找到绑定的ID为"+c.bind+"的子菜单"):""==c.class&&c.child.attr("disabled",!0)),null!=t.data("width")?(c.width=t.data("width"),_.endsWith(c.width,"%")||(c.width+="px")):c.width=t.outerWidth()+"px",t.children("option").each(function(t){var e=$(this),a=[e.val(),e.text(),""],l=a[0],i=a[1],n=a[2];if(0==t)return!0;if(e.is(":disabled")?n="disabled":e.is(":selected")&&(c.selected=t,null==c.bind&&(n="active")),null!=c.multiple){var s="";""!=c.default&&-1!=c.default.indexOf(l)&&(s=" checked",c.txtArr.push(i)),i='<label>\n\t\t\t\t\t\t\t\t\t<input type="checkbox" value="'+l+'" '+s+' data-txt="'+i+'"> '+i+"\n\t\t\t\t\t\t\t\t</label>",n+=" multiple"}c.li+='<li class="'+n+'" data-val="'+l+'">'+i+"</li>"}),null==c.multiple?c.txt=t.find(":selected").text():0==c.txtArr.length?c.txt="请选择":c.txt=_.join(c.txtArr,"、"),c.html='<div style="width:'+c.width+';" class="select'+c.disabled+'" data-open="0">\n\t\t\t\t\t\t\t\t<span class="'+c.class+'">'+c.txt+'</span>\n\t\t\t\t\t\t\t\t<i class="ri-arrow-down-s-line rotate-0"></i>\n\t\t\t\t\t\t\t\t<i class="ri-close-circle-fill select-clear"></i>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style="width:'+c.width+';" class="select-option animated faster'+(null!=c.multiple?" select-multiple":"")+'">\n\t\t\t\t\t\t\t\t<ul class="iscroll">'+c.li+"</ul></div>",t.after(c.html),""!=c.class&&null!=c.bind&&t.next().next().find("li").eq(c.selected-1).trigger("click"),Mount.observer.observe(t[0],{attributeFilter:["disabled"]})});var l=e.find(":radio");0<l.length&&l.each(function(){var t=$(this),e={class:"radio"};"switch"==t.data("model")?(t.prop("checked",!0),e.checked="",1==t.val()&&(e.checked=" switch-open"),e.disabled=t.is(":disabled")?" switch-disabled":"",e.html='<div class="checkbox-switch'+e.checked+e.disabled+'">\n\t\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t</div>',t.parent().append(e.html)):(e.class+=t.is(":disabled")?"-disabled":"",e.class+=t.is(":checked")?"-checked":"",t.parent().addClass(e.class),e.icon=t.is(":checked")?"ri-radio-button-line":"ri-checkbox-blank-circle-line",e.html='<i class="'+e.icon+'"></i>',t.before(e.html)),Mount.observer.observe(t[0],{attributeFilter:["disabled"]})});var i=e.find(":checkbox");0<i.length&&i.each(function(){var t=$(this),e={class:"checkbox"};e.class+=t.is(":disabled")?"-disabled":"",e.class+=t.is(":checked")?"-checked":"",t.parent().addClass(e.class),e.icon=t.is(":checked")?"ri-checkbox-line":"ri-checkbox-blank-line",t.hasClass("checkbox-half")&&(e.icon="ri-checkbox-indeterminate-line"),e.html='<i class="'+e.icon+'"></i>',t.before(e.html),Mount.observer.observe(t[0],{attributeFilter:["disabled"]})})}},{key:"event",value:function(){var t=[".select:not(.select-disabled)",".select-option",".select-option li:not(.disabled):not(.active):not(.multiple)",".add, .cut",":radio",":checkbox",".checkbox-switch:not(.switch-disabled)",".select-multiple",".select-multiple :checkbox",".select-clear",".num-input"];body.on("click",t[0],function(){var t=$(this),e={p:t.position(),o:t.next(".select-option")};if(e.oHeight=e.o.outerHeight()+10,e.o.css("left",e.p.left),distance(t,"bottom")<e.oHeight&&e.o.css("top",e.p.top-e.oHeight),e.open=1==t.data("open")?0:1,t.data("open",e.open),e.i=t.children("i:first"),0==e.open)return e.i.removeClass("rotate-180").addClass("rotate-0"),void fadeOut(e.o);e.i.removeClass("rotate-0").addClass("rotate-180"),fadeIn(e.o),e.o.attr("tabindex",0).trigger("focus")}).on("mouseenter",t[0],function(){var t=$(this),e=t.prev().find(":selected").index();t.next(".select-option").data("active",1),0!=e&&t.find(".select-clear").show().prev().hide()}).on("mouseleave",t[0],function(){var t=$(this),e=t.prev().find(":selected").index();t.next(".select-option").data("active",0),0!=e&&t.find(".select-clear").hide().prev().show()}).on("mouseover",t[7],function(){$(this).data("active",1)}).on("mouseout",t[7],function(){$(this).data("active",0)}).on("blur",t[1],function(){var t=$(this);1!=t.data("active")&&(t.prev().data("open",0).children("i").removeClass("rotate-180").addClass("rotate-0"),fadeOut(t))}).on("click",t[2],function(){var t=$(this),a={val:t.data("val"),txt:t.html(),select:t.parent().parent().prev().prev()};a.default=a.select.find("option:first").val(),a.select.val(a.val).next().children("span").addClass("selected").html(a.txt),t.addClass("active").siblings(".active").removeClass("active"),t.parent().parent().trigger("blur"),a.select.trigger("change"),a.bind=a.select.data("bind"),null!=a.bind&&(a.api=a.select.data("api"),null!=a.api&&""!=a.api?(a.child=$("#"+a.bind),a.child.next(".select").children("span").html('<i class="ri-loader-4-line rotate"></i>'),Eadmin.get({url:a.api+=a.val,then:function(t){var e=['<option value="'+a.default+'"></option>',"",a.child.data("selected"),"请选择"],i=e[0],n=e[1],s=e[2],c=e[3];_.each(t,function(t,e){var a="",l="";e==s&&(a=" selected",l=' class="active"',c=t),i+='<option value="'+e+'"'+a+">"+t+"</option>",n+='<li data-val="'+e+'"'+l+">"+t+"</li>"}),a.child.html(i),a.child.attr("disabled",!1).next(".select").removeClass("select-disabled").children("span").html(c),a.child.next().next().children("ul").html(n)}})):console.log("没有设置子菜单数据调用的API地址"))}).on("click",t[9],function(){var t=$(this),e={span:t.prev().prev()};return e.select=e.span.parent(),e.real=e.select.prev(),e.option=e.select.next(),e.custom=e.real.data("custom-txt"),e.span.html("请选择"+(e.custom||"")),e.real.val(e.real.find("option:first").val()),e.option.find(".active").removeClass("active"),t.hide().prev().show(),!1}).on("click",t[8],function(){var e={txt:[],val:[],ul:$(this).parent().parent().parent()};e.ul.find(":checked").each(function(){var t=$(this);e.txt.push(t.data("txt")),e.val.push(t.val())}),e.txt=_.join(e.txt,"、"),e.val=_.join(e.val,","),e.select=e.ul.parent().prev(),""==e.txt&&(e.txt="请选择",e.customTxt=e.select.data("custom-txt"),e.txt+=e.customTxt||""),e.select.children("span").html(e.txt),e.select.prev().prev().val(e.val)}).on("click",t[3],function(){var t=$(this);if(!t.hasClass("disabled")){var e={input:t.parent().prev()};if(!e.input.is(":disabled")){if(e.min=e.input.data("min")||0,e.max=e.input.data("max")||0,e.step=e.input.data("step")||1,e.val=+e.input.val(),t.hasClass("add"))return e.val+=+e.step,0<e.max&&e.val==e.max&&t.addClass("disabled"),e.input.val(e.val),void t.next().removeClass("disabled");e.val-=+e.step,e.val<=e.min&&t.addClass("disabled"),e.input.val(e.val),t.prev().removeClass("disabled")}}}).on("mousedown",t[3],function(t){t.preventDefault()}).on("blur",t[10],function(){var t=$(this),e={val:t.val(),min:t.data("min"),max:t.data("max"),btn:t.next().children("i")};if(null!=e.min&&e.val<e.min)return t.val(e.min),e.btn.eq(0).removeClass("disabled"),void e.btn.eq(1).addClass("disabled");null!=e.max&&e.val>e.max&&(t.val(e.max),e.btn.eq(0).addClass("disabled"),e.btn.eq(1).removeClass("disabled"))}).on("click",t[4],function(){var t=[$(this),{}],e=t[0],a=t[1];"switch"!==e.data("model")&&(a.radio=e.parent(),a.radio.hasClass("radio-checked")||(a.radio.removeClass("radio").addClass("radio-checked").children("i").attr("class","ri-radio-button-line"),a.radio.siblings(".radio-checked").addClass("radio").removeClass("radio-checked").children("i").attr("class","ri-checkbox-blank-circle-line")))}).on("click",t[5],function(){console.log(1);var t=$(this),e={checkbox:t.parent()};t.is(":checked")?e.checkbox.attr("class","checkbox-checked").children("i").attr("class","ri-checkbox-line"):(t.removeClass("checkbox-half"),e.checkbox.attr("class","checkbox").children("i").attr("class","ri-checkbox-blank-line"))}).on("click",t[6],function(){var t=$(this),e={radio:t.prev(":radio")};1==e.radio.val()?(t.removeClass("switch-open"),e.radio.val(0)):(t.addClass("switch-open"),e.radio.val(1))}).on("submit","form",function(){var l=$(this),i={action:l.attr("action")||Eadmin.currentHref};if(Validate.submit(l),0<l.find("span.error").length)return!1;if(i.submit=l.find("[data-submit]"),0<i.submit.length&&null!=i.submit.data("loading")&&Eadmin.button.loading(i.submit),null!=l.data("native"))return!0;i.formData=l.serialize(),i.callback=l.data("callback");var n=function(t){if(null!=i.callback)try{if(Method,!_.isFunction(Method[i.callback]))return void console.log("指定的"+i.callback+"不是一个可被调用的函数");Method[i.callback](t)}catch(t){console.log(t)}};return Eadmin.post({url:i.action,form:i.formData,then:function(t){var e=l.find(".editor");if(0<e.length){var a=e.data("store");null!=a&&store.remove(a)}Eadmin.button.reset(i.submit),n(t)},error:function(t){Eadmin.button.reset(i.submit),n(t)}}),!1}).on("keyup",".textarea-max",function(){var t=$(this),e=t.attr("maxlength"),a=t.val().length;e<a||t.next().html(a+" / "+e)})}},{key:"checkbox",value:function(t,e){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2],l={};1==e?(l={checked:!0,i_class:"ri-checkbox-line",class:"checkbox-checked"},a?(l.i_class="ri-checkbox-indeterminate-line",t.addClass("checkbox-half")):t.removeClass("checkbox-half")):(l={checked:!1,i_class:"ri-checkbox-blank-line",class:"checkbox"},t.removeClass("checkbox-half")),t.prop("checked",l.checked).prev("i").attr("class",l.i_class).parent("label").attr("class",l.class)}},{key:"select",value:function(t){var e=t.find("select");0!=e.length&&e.each(function(){var t=$(this),e={txt:t.children("option:first").text(),default:t.find("option:first").val()};t.val(e.default).next().children("span").removeClass("selected").html(e.txt),t.next().next().find(".active").removeClass("active")})}},{key:"input",value:function(t){1<arguments.length&&void 0!==arguments[1]&&arguments[1]?t.removeClass("error-input"):t.addClass("error-input")}},{key:"textarea",value:function(t){1<arguments.length&&void 0!==arguments[1]&&arguments[1]?t.removeClass("error-input"):t.addClass("error-input")}}]),t}();