/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function i(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,a){return e&&i(t.prototype,e),a&&i(t,a),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Form=function(){function l(){_classCallCheck(this,l)}return _createClass(l,null,[{key:"init",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=null==t?box:t;module.conf.close_autocomplete&&e.find("input[type='text']").attr("autocomplete","off"),e.find("input[type='text']").each(function(){var t={this:$(this),class:"icon-input"};if(t.icon=t.this.data("icon"),null!=t.icon&&!t.this.hasClass("num-input")){if(-1!=t.icon.indexOf("|")){var e=t.icon.split("|");t.icon=e[0],t.class="right"==e[1]?t.class+"-right":t.class}t.this.parent().is("label")?(t.this.before('<i class="'+t.icon+'"></i>'),t.this.parent().addClass(t.class)):(t.this.before('<label class="'+t.class+'"></label>'),t.label=t.this.prev("label"),$('<i class="'+t.icon+'"></i>').appendTo(t.label),t.this.appendTo(t.label))}if(t.model=t.this.data("model"),null!=t.model&&l.input(t.this,t.model,!0),t.prepend=t.this.data("prepend"),null!=t.prepend){var a='<div class="input-group">\n\t\t\t\t\t\t\t\t<span class="prepend">'+t.prepend+"</span>\n\t\t\t\t\t\t\t</div>";t.this.before(a),t.this.appendTo(t.this.prev(".input-group"))}if(t.append=t.this.data("append"),null!=t.append){if(!t.this.parent().is(".input-group")){t.this.before('<div class="input-group"></div>'),t.this.appendTo(t.this.prev(".input-group"))}$('<span class="append">'+t.append+"</span>").appendTo(t.this.parent())}if(t.this.hasClass("num-input")){""==t.this.val()?(t.this.val(0),t.val=0):t.val=parseInt(t.this.val()),t.min=null==t.this.data("min")?0:parseInt(t.this.data("min")),t.max=null==t.this.data("max")?0:parseInt(t.this.data("max")),t.add=0<t.max&&t.val>=t.max?"disabled":"",t.cut=t.val<=t.min?"disabled":"",t.html='<span class="num-add-cut">\n\t\t\t\t\t\t\t<i class="ri-arrow-up-s-line add '+t.add+'"></i>\n\t\t\t\t\t\t\t<i class="ri-arrow-down-s-line cut '+t.cut+'"></i>\n\t\t\t\t\t\t</span>',t.this.before('<div class="input-group"></div>');var i=t.this.prev(".input-group");t.this.appendTo(i),$(t.html).appendTo(i)}if(t.date=t.this.data("default-date"),null!=t.date&&0==t.this.next("input").length){var s=t.this.attr("name");null!=s?t.this.removeAttr("name").after('<input type="hidden" name="'+s+'" value="'+t.date+'">'):console.log("没有为日期文本框指定name属性，这将影响后端取值")}}),e.find("textarea[maxlength]").each(function(){var t={this:$(this)};t.max=t.this.attr("maxlength"),t.len=t.this.text().length,t.html='<span class="font-num">'+t.len+" / "+t.max+"</span>",t.this.addClass("no-resize textarea-max").after(t.html)});var a=e.find(":radio");0<a.length&&a.each(function(){var t={this:$(this),class:"radio"};"switch"==t.this.data("model")?(t.this.prop("checked",!0),t.checked="",1==t.this.val()&&(t.checked=" switch-open"),t.disabled=t.this.is(":disabled")?" switch-disabled":"",t.html='<div class="checkbox-switch'+t.checked+t.disabled+'">\n\t\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t</div>',t.this.parent().append(t.html)):(t.class+=t.this.is(":disabled")?"-disabled":"",t.class+=t.this.is(":checked")?"-checked":"",t.this.parent().addClass(t.class),t.icon=t.this.is(":checked")?"ri-radio-button-line":"ri-checkbox-blank-circle-line",t.html='<i class="'+t.icon+'"></i>',t.this.before(t.html)),Mount.observer.observe(t.this[0],{attributeFilter:["disabled"]})});var i=e.find(":checkbox");0<i.length&&i.each(function(){var t={this:$(this),class:"checkbox"};t.class+=t.this.is(":disabled")?"-disabled":"",t.class+=t.this.is(":checked")?"-checked":"",t.this.parent().addClass(t.class),t.icon=t.this.is(":checked")?"ri-checkbox-line":"ri-checkbox-blank-line",t.this.hasClass("checkbox-half")&&(t.icon="ri-checkbox-indeterminate-line"),t.html='<i class="'+t.icon+'"></i>',t.this.before(t.html),Mount.observer.observe(t.this[0],{attributeFilter:["disabled"]})});var s=e.find("select:not([class^='ql-'])");0<s.length&&s.each(function(){var s={this:$(this),li:"",disabled:""};s.this.is(":disabled")&&(s.disabled=" select-disabled"),s.bind=s.this.data("bind"),null!=s.bind&&(s.child=e.find("#"+s.bind),0==s.child.length?console.log("没有找到绑定的ID为"+s.bind+"的子菜单"):s.child.attr("disabled",!0)),null!=s.this.data("width")?(s.width=s.this.data("width"),_.endsWith(s.width,"%")||(s.width+="px")):s.width=s.this.outerWidth()+"px",s.txt=s.this.find(":selected").text(),s.class=s.this.val()==module.conf.select_default_val||""!=s.disabled?"":"selected",s.html='<div style="width:'+s.width+';" class="select'+s.disabled+'" data-open="0">\n\t\t\t\t\t\t\t\t<span class="'+s.class+'">'+s.txt+'</span>\n\t\t\t\t\t\t\t\t<i class="ri-arrow-down-s-line rotate-0"></i>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style="width:'+s.width+';" class="select-option animated faster">\n\t\t\t\t\t\t\t\t<ul class="iscroll">',s.this.children("option").each(function(){var t=$(this),e=t.val(),a=t.text(),i="";if(e==module.conf.select_default_val)return!0;t.is(":disabled")?i="disabled":t.is(":selected")&&(i="active"),s.li+='<li class="'+i+'" data-val="'+e+'">\n\t\t\t\t\t\t\t\t'+a+"\n\t\t\t\t\t\t\t</li>"}),s.html+=s.li+"</ul></div>",s.this.after(s.html),Mount.observer.observe(s.this[0],{attributeFilter:["disabled"]})})}},{key:"event",value:function(){var t=[".select:not(.select-disabled)",".select-option",".select-option li:not(.disabled):not(.active)",".add, .cut",":radio",":checkbox",".checkbox-switch:not(.switch-disabled)"];body.on("click",t[0],function(){var t={this:$(this)};if(t.p=t.this.position(),t.o=t.this.next(".select-option"),t.oHeight=t.o.outerHeight(),t.oHeight+=10,t.o.css("left",t.p.left),distance(t.this,"bottom")<t.oHeight&&t.o.css("top",t.p.top-t.oHeight),t.open=1==t.this.data("open")?0:1,t.this.data("open",t.open),t.i=t.this.children("i"),0==t.open)return t.i.removeClass("rotate-180").addClass("rotate-0"),void fadeOut(t.o);t.i.removeClass("rotate-0").addClass("rotate-180"),fadeIn(t.o),t.o.attr("tabindex",0).focus()}).on("mouseover",t[0],function(){$(this).next(".select-option").data("active",1)}).on("mouseout",t[0],function(){$(this).next(".select-option").data("active",0)}).on("blur",t[1],function(){var t=$(this);1!=t.data("active")&&(t.prev().data("open",0).children("i").removeClass("rotate-180").addClass("rotate-0"),fadeOut(t))}).on("click",t[2],function(){var e={this:$(this)};e.val=e.this.data("val"),e.txt=e.this.html(),e.select=e.this.parent().parent().prev().prev(),e.select.val(e.val).next().children("span").addClass("selected").html(e.txt),e.this.addClass("active").siblings(".active").removeClass("active"),e.this.parent().parent().trigger("blur"),e.select.trigger("change"),e.bind=e.select.data("bind"),null!=e.bind&&(e.api=e.select.data("api"),null!=e.api&&""!=e.api?(e.child=$("#"+e.bind),e.child.next(".select").children("span").html('<i class="ri-loader-4-line rotate"></i>'),axios.get(e.api+=e.val).then(function(t){var a='<option value="'+module.conf.select_default_val+'"></option>',i="";_.each(t.data,function(t,e){a+='<option value="'+e+'">'+t+"</option>",i+='<li data-val="'+e+'">'+t+"</li>"}),e.child.html(a),e.child.next(".select").removeClass("select-disabled").children("span").html("请选择"),e.child.next().next().children("ul").html(i)}).catch(function(t){console.log(t)})):console.log("没有设置子菜单数据调用的API地址"))}).on("click",t[3],function(){var t={this:$(this)};if(!t.this.hasClass("disabled")){if(t.input=t.this.parent().prev(),t.min=null==t.input.data("min")?0:t.input.data("min"),t.max=null==t.input.data("max")?0:t.input.data("max"),t.step=null==t.input.data("step")?1:t.input.data("step"),t.val=parseInt(t.input.val()),t.this.hasClass("add"))return t.val+=parseInt(t.step),0<t.max&&t.val==t.max&&t.this.addClass("disabled"),t.input.val(t.val),void t.this.next().removeClass("disabled");t.val-=parseInt(t.step),t.val<=t.min&&t.this.addClass("disabled"),t.input.val(t.val),t.this.prev().removeClass("disabled")}}).on("mousedown",t[3],function(t){t.preventDefault()}).on("click",t[4],function(){var t={this:$(this)};"switch"!==t.this.data("model")&&(t.radio=t.this.parent(),t.radio.hasClass("radio-checked")||(t.radio.removeClass("radio").addClass("radio-checked").children("i").attr("class","ri-radio-button-line"),t.radio.siblings(".radio-checked").addClass("radio").removeClass("radio-checked").children("i").attr("class","ri-checkbox-blank-circle-line")))}).on("click",t[5],function(){var t={this:$(this)};t.checkbox=t.this.parent(),t.this.is(":checked")?t.checkbox.attr("class","checkbox-checked").children("i").attr("class","ri-checkbox-line"):(t.this.removeClass("checkbox-half"),t.checkbox.attr("class","checkbox").children("i").attr("class","ri-checkbox-blank-line"))}).on("click",t[6],function(){var t={this:$(this)};t.radio=t.this.prev(":radio"),1==t.radio.val()?(t.this.removeClass("switch-open"),t.radio.val(0)):(t.this.addClass("switch-open"),t.radio.val(1))}).on("submit","form",function(){var l={this:$(this)};return l.action=l.this.attr("action"),null==l.action?(console.log("提交的表单没有指定action参数，无法识别需要提交到哪里"),!1):(Validate.submit(l.this),!(0<l.this.find("span.error").length)&&(l.submit=l.this.find("[data-submit]"),0<l.submit.length&&null!=l.submit.data("loading")&&Button.loading(l.submit),null!=l.this.data("native")||(l.formData=l.this.serialize(),l.callback=l.this.data("callback"),axios.post(l.action,l.formData).then(function(t){var e=t.data;if(null!=e[module.conf.http.code_field]){var a="";if(null!=e[module.conf.http.msg_field]&&(a=e[module.conf.http.msg_field]),e[module.conf.http.code_field]!=module.conf.http.code_success)""==a&&(a="操作执行失败"),Eadmin.message.error({content:a}),Eadmin.button.reset(l.submit);else{""==a&&(a="操作执行成功");var i=l.this.find(".editor");if(0<i.length){var s=i.data("store");null!=s&&store.remove(s)}if(Eadmin.message.success({content:a}),Eadmin.button.reset(l.submit),null==l.callback)return;try{if(Method,!_.isFunction(Method[l.callback]))return void console.log("指定的"+l.callback+"不是一个可被调用的函数");Method[l.callback](e)}catch(t){console.log(t)}}}else console.log("接口返回结果中没有找到定义的code码字段")}).catch(function(t){Eadmin.message.error({content:t}),Eadmin.button.reset(l.submit)}),!1)))}).on("keyup",".textarea-max",function(){var t=$(this),e=t.attr("maxlength"),a=t.val().length;e<a||t.next().html(a+" / "+e)})}},{key:"checkbox",value:function(t,e){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i={};1==e?(i={checked:!0,i_class:"ri-checkbox-line",class:"checkbox-checked"},a?(i.i_class="ri-checkbox-indeterminate-line",t.addClass("checkbox-half")):t.removeClass("checkbox-half")):(i={checked:!1,i_class:"ri-checkbox-blank-line",class:"checkbox"},t.removeClass("checkbox-half")),t.prop("checked",i.checked).prev("i").attr("class",i.i_class).parent("label").attr("class",i.class)}},{key:"select",value:function(t){var e=t.find("select");0!=e.length&&e.each(function(){var t={this:$(this)};t.txt=t.this.children("option:first").text(),t.this.val(module.conf.select_default_val).next().children("span").removeClass("selected").html(t.txt),t.this.next().next().find(".active").removeClass("active")})}},{key:"input",value:function(t,e){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(e!=t.data("model")||a)if(null!=e){null==t.data("model")?t.addClass("color-input"):(t.parent().removeClass(t.data("model")+"-input"),t.prev("i").remove()),t.data("model",e);var i="";switch(e){case"success":i="ri-checkbox-circle-fill";break;case"error":i="ri-close-circle-fill";break;case"notice":i="ri-information-fill"}if(t.parent().is("label")||t.hasClass("num-input"))t.parent().addClass(e+"-input"),t.hasClass("num-input")||(t.prev("i").hide(),t.before('<i class="'+i+'"></i>'));else{t.before('<label class="'+e+'-input"></label>');var s=t.prev("label");$('<i class="'+i+'"></i>').appendTo(s),t.appendTo(s)}}else t.hasClass("num-input")?(t.removeData("model").removeClass("color-input"),t.parent().attr("class","input-group")):(e=t.data("model"),t.removeData("model").removeClass("color-input").prev("i").remove(),0==t.prev("i").length?t.parent().removeAttr("class"):t.prev("i").show().parent().removeClass(e+"-input"))}},{key:"textarea",value:function(t,e){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(e!=t.data("model")||a)if(null!=e)if(null==t.data("model")&&t.addClass("color-input"),t.data("model",e),t.parent().is("label"))t.parent().attr("class",e+"-input");else{t.before('<label class="'+e+'-input"></label>');var i=t.prev("label");t.appendTo(i)}else t.removeData("model").removeClass("color-input").parent().removeAttr("class")}}]),l}();