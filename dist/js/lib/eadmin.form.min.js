/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function l(t,e){for(var a=0;a<e.length;a++){var l=e[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}return function(t,e,a){return e&&l(t.prototype,e),a&&l(t,a),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Form=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"init",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:null)||box,t=e.find('input[type="text"]');module.conf.close_autocomplete&&t.attr("autocomplete","off"),t.each(function(){var t,e=$(this),a={class:"icon-input",numinput:e.hasClass("num-input")};a.icon=e.data("icon"),null==a.icon||a.numinput||(-1!=a.icon.indexOf("|")&&(a.arr=a.icon.split("|"),a.icon=a.arr[0],a.class="right"==a.arr[1]?a.class+"-right":a.class),e.parent().is("label")?(e.before('<i class="'+a.icon+'"></i>'),e.parent().addClass(a.class)):(e.before('<label class="'+a.class+'"></label>'),a.label=e.prev("label"),$('<i class="'+a.icon+'"></i>').appendTo(a.label),e.appendTo(a.label))),a.prepend=e.data("prepend"),null!=a.prepend&&(t='<div class="input-group">\n\t\t\t\t\t\t\t\t<span class="prepend">'+a.prepend+"</span>\n\t\t\t\t\t\t\t</div>",e.before(t),e.appendTo(e.prev(".input-group"))),a.append=e.data("append"),null!=a.append&&(e.parent().is(".input-group")||(e.before('<div class="input-group"></div>'),e.appendTo(e.prev(".input-group"))),$('<span class="append">'+a.append+"</span>").appendTo(e.parent())),a.numinput&&(""==e.val()?(e.val(0),a.val=0):a.val=e.val(),a.min=e.data("min")||0,a.max=e.data("max")||0,a.add=0<a.max&&a.val>=a.max?"disabled":"",a.cut=a.val<=a.min?"disabled":"",a.html='<span class="num-add-cut">\n\t\t\t\t\t\t\t<i class="ri-arrow-up-s-line add '+a.add+'"></i>\n\t\t\t\t\t\t\t<i class="ri-arrow-down-s-line cut '+a.cut+'"></i>\n\t\t\t\t\t\t</span>',e.before('<div class="input-group"></div>'),a.group=e.prev(".input-group"),e.appendTo(a.group),$(a.html).appendTo(a.group)),a.date=e.data("default-date"),null!=a.date&&0==e.next("input").length&&(null!=(t=e.attr("name"))?e.removeAttr("name").after('<input type="hidden" name="'+t+'" value="'+a.date+'">'):console.log("没有为日期文本框指定name属性，这将影响后端取值"))}),e.find("textarea[maxlength]").each(function(){var t=$(this),e=[t.attr("maxlength"),t.text().length],e='<span class="font-num">'+e[1]+" / "+e[0]+"</span>";t.addClass("no-resize textarea-max").after(e)});t=e.find("select:not([class^='ql-'])");0<t.length&&t.each(function(){var t=$(this),n={li:"",default:"",multiple:t.data("multiple"),disabled:"",class:"",index:t.find(":selected").index(),selected:null,txtArr:[]};null!=n.multiple&&(n.name=t.attr("name"),null==n.name&&console.log("下拉菜单上没有指定name,后端无法取值"),n.default=t.data("selected")||"",t.removeAttr("name").before('<input type="hidden" name="'+n.name+'" value="'+n.default+'">'),n.default=n.default.split(",")),t.is(":disabled")&&(n.disabled=" select-disabled"),n.class=0==n.index||""!=n.disabled?"":"selected",n.bind=t.data("bind"),null!=n.bind&&(n.child=e.find("#"+n.bind),0==n.child.length?console.log("没有找到绑定的ID为"+n.bind+"的子菜单"):""==n.class&&n.child.attr("disabled",!0)),null!=t.data("width")?(n.width=t.data("width"),_.endsWith(n.width,"%")||(n.width+="px")):n.width=t.outerWidth()+"px",t.children("option").each(function(t){var e=$(this),a=[e.val(),e.text(),""],l=a[0],i=a[1],a=a[2];if(0==t)return!0;e.is(":disabled")?a="disabled":e.is(":selected")&&(n.selected=t,null==n.bind&&(a="active")),null!=n.multiple&&((t="")!=n.default&&-1!=n.default.indexOf(l)&&(t=" checked",n.txtArr.push(i)),i='<label>\n\t\t\t\t\t\t\t\t\t<input type="checkbox" value="'+l+'" '+t+' data-txt="'+i+'"> '+i+"\n\t\t\t\t\t\t\t\t</label>",a+=" multiple"),n.li+='<li class="'+a+'" data-val="'+l+'">'+i+"</li>"}),null==n.multiple?n.txt=t.find(":selected").text():0==n.txtArr.length?n.txt="请选择":n.txt=_.join(n.txtArr,"、"),n.html='<div style="width:'+n.width+';" class="select'+n.disabled+'" data-open="0">\n\t\t\t\t\t\t\t\t<span class="'+n.class+'">'+n.txt+'</span>\n\t\t\t\t\t\t\t\t<i class="ri-arrow-down-s-line rotate-0"></i>\n\t\t\t\t\t\t\t\t<i class="ri-close-circle-fill select-clear"></i>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div style="width:'+n.width+';" class="select-option animated faster'+(null!=n.multiple?" select-multiple":"")+'">\n\t\t\t\t\t\t\t\t<ul class="iscroll">'+n.li+"</ul></div>",t.after(n.html),""!=n.class&&null!=n.bind&&t.next().next().find("li").eq(n.selected-1).trigger("click"),Mount.observer.observe(t[0],{attributeFilter:["disabled"]})});t=e.find(":radio");0<t.length&&t.each(function(){var t=$(this),e={class:"radio",model:t.data("model"),icon:["ri-radio-button-line","ri-checkbox-blank-circle-line"]};"switch"==e.model?(t.prop("checked",!0),e.checked="",1==t.val()&&(e.checked=" switch-open"),e.disabled=t.is(":disabled")?" switch-disabled":"",e.html='<div class="checkbox-switch'+e.checked+e.disabled+'">\n\t\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t</div>',t.parent().append(e.html)):(e.class+=t.is(":disabled")?"-disabled":"",e.class+=t.is(":checked")?"-checked":"","tag"==e.model?e.class+="-tag":t.before('<i class="'+(t.is(":checked")?e.icon[0]:e.icon[1])+'"></i>'),t.parent().addClass(e.class)),Mount.observer.observe(t[0],{attributeFilter:["disabled"]})});t=e.find(":checkbox");0<t.length&&t.each(function(){var t=$(this),e={class:"checkbox"};e.class+=t.is(":disabled")?"-disabled":"",e.class+=t.is(":checked")?"-checked":"",t.parent().addClass(e.class),e.icon=t.is(":checked")?"ri-checkbox-line":"ri-checkbox-blank-line",t.hasClass("checkbox-half")&&(e.icon="ri-checkbox-indeterminate-line"),e.html='<i class="'+e.icon+'"></i>',t.before(e.html),Mount.observer.observe(t[0],{attributeFilter:["disabled"]})})}},{key:"event",value:function(){var t=[".select:not(.select-disabled)",".select-option",".select-option li:not(.disabled):not(.active):not(.multiple)",".add, .cut",":radio",":checkbox",".checkbox-switch:not(.switch-disabled)",".select-multiple",".select-multiple :checkbox",".select-clear",".num-input"];body.on("click",t[0],function(){var t=$(this),e={p:t.position(),o:t.next(".select-option")};if(e.oHeight=e.o.outerHeight()+10,e.o.css("left",e.p.left),distance(t,"bottom")<e.oHeight&&e.o.css("top",e.p.top-e.oHeight),e.open=1==t.data("open")?0:1,t.data("open",e.open),e.i=t.children("i:first"),0==e.open)return e.i.removeClass("rotate-180").addClass("rotate-0"),void fadeOut(e.o);e.i.removeClass("rotate-0").addClass("rotate-180"),fadeIn(e.o),e.o.attr("tabindex",0).trigger("focus")}).on("mouseenter",t[0],function(){var t=$(this),e=t.prev().find(":selected").index();t.next(".select-option").data("active",1),0!=e&&t.find(".select-clear").show().prev().hide()}).on("mouseleave",t[0],function(){var t=$(this),e=t.prev().find(":selected").index();t.next(".select-option").data("active",0),0!=e&&t.find(".select-clear").hide().prev().show()}).on("mouseover",t[7],function(){$(this).data("active",1)}).on("mouseout",t[7],function(){$(this).data("active",0)}).on("blur",t[1],function(){var t=$(this);1!=t.data("active")&&(t.prev().data("open",0).children("i").removeClass("rotate-180").addClass("rotate-0"),fadeOut(t))}).on("click",t[2],function(){var t=$(this),a={val:t.data("val"),txt:t.html(),select:t.parent().parent().prev().prev()};a.default=a.select.find("option:first").val(),a.select.val(a.val).next().children("span").addClass("selected").html(a.txt),t.addClass("active").siblings(".active").removeClass("active"),t.parent().parent().trigger("blur"),a.select.trigger("change"),a.bind=a.select.data("bind"),null!=a.bind&&(a.api=a.select.data("api"),null!=a.api&&""!=a.api?(a.child=$("#"+a.bind),a.child.next(".select").children("span").html('<i class="ri-loader-4-line rotate"></i>'),Eadmin.get({url:a.api+=a.val,then:function(t){var e=['<option value="'+a.default+'"></option>',"",a.child.data("selected"),"请选择"],i=e[0],n=e[1],s=e[2],c=e[3];_.each(t,function(t,e){var a="",l="";e==s&&(a=" selected",l=' class="active"',c=t),i+='<option value="'+e+'"'+a+">"+t+"</option>",n+='<li data-val="'+e+'"'+l+">"+t+"</li>"}),a.child.html(i),a.child.attr("disabled",!1).next(".select").removeClass("select-disabled").children("span").html(c),a.child.next().next().children("ul").html(n)}})):console.log("没有设置子菜单数据调用的API地址"))}).on("click",t[9],function(){var t=$(this),e={span:t.prev().prev()};return e.select=e.span.parent(),e.real=e.select.prev(),e.option=e.select.next(),e.custom=e.real.data("custom-txt"),e.span.html("请选择"+(e.custom||"")),e.real.val(e.real.find("option:first").val()),e.option.find(".active").removeClass("active"),t.hide().prev().show(),!1}).on("click",t[8],function(){var e={txt:[],val:[],ul:$(this).parent().parent().parent()};e.ul.find(":checked").each(function(){var t=$(this);e.txt.push(t.data("txt")),e.val.push(t.val())}),e.txt=_.join(e.txt,"、"),e.val=_.join(e.val,","),e.select=e.ul.parent().prev(),""==e.txt&&(e.txt="请选择",e.customTxt=e.select.data("custom-txt"),e.txt+=e.customTxt||""),e.select.children("span").html(e.txt),e.select.prev().prev().val(e.val)}).on("click",t[3],function(){var t=$(this);if(!t.hasClass("disabled")){var e={input:t.parent().prev()};if(!e.input.is(":disabled")){if(e.min=e.input.data("min")||0,e.max=e.input.data("max")||0,e.step=e.input.data("step")||1,e.val=+e.input.val(),t.hasClass("add"))return e.val+=+e.step,0<e.max&&e.val==e.max&&t.addClass("disabled"),e.input.val(e.val),void t.next().removeClass("disabled");e.val-=+e.step,e.val<=e.min&&t.addClass("disabled"),e.input.val(e.val),t.prev().removeClass("disabled")}}}).on("mousedown",t[3],function(t){t.preventDefault()}).on("blur",t[10],function(){var t=$(this),e={val:t.val(),min:t.data("min"),max:t.data("max"),btn:t.next().children("i")};if(null!=e.min&&e.val<e.min)return t.val(e.min),e.btn.eq(0).removeClass("disabled"),void e.btn.eq(1).addClass("disabled");null!=e.max&&e.val>e.max&&(t.val(e.max),e.btn.eq(0).addClass("disabled"),e.btn.eq(1).removeClass("disabled"))}).on("click",t[4],function(){var t=[$(this),{}],e=t[0],t=t[1];t.radio=e.parent(),t.icon=["ri-radio-button-line","ri-checkbox-blank-circle-line"],"switch"===e.data("model")||t.radio.hasClass("radio-checked")||t.radio.hasClass("radio-checked-tag")||("tag"!=e.data("model")?(t.radio.removeClass("radio").addClass("radio-checked").children("i").attr("class",t.icon[0]),t.radio.siblings(".radio-checked").addClass("radio").removeClass("radio-checked").children("i").attr("class",t.icon[1])):t.radio.attr("class","radio-checked-tag").siblings(".radio-checked-tag").attr("class","radio-tag"))}).on("click",t[5],function(){console.log(1);var t=$(this),e={checkbox:t.parent()};t.is(":checked")?e.checkbox.attr("class","checkbox-checked").children("i").attr("class","ri-checkbox-line"):(t.removeClass("checkbox-half"),e.checkbox.attr("class","checkbox").children("i").attr("class","ri-checkbox-blank-line"))}).on("click",t[6],function(){var t=$(this),e={radio:t.prev(":radio")};1==e.radio.val()?(t.removeClass("switch-open"),e.radio.val(0)):(t.addClass("switch-open"),e.radio.val(1))}).on("submit","form",function(){var a=$(this),l={action:a.attr("action")||Eadmin.currentHref};if(Validate.submit(a),0<a.find("span.error").length)return!1;if(l.submit=a.find("[data-submit]"),0<l.submit.length&&null!=l.submit.data("loading")&&Eadmin.button.loading(l.submit),null!=a.data("native"))return!0;l.formData=a.serialize(),l.callback=a.data("callback");function i(t){if(null!=l.callback)try{if(Method,!_.isFunction(Method[l.callback]))return console.log("指定的"+l.callback+"不是一个可被调用的函数"),0;Method[l.callback](t)}catch(t){console.log(t)}}return Eadmin.post({url:l.action,form:l.formData,then:function(t){var e=a.find(".editor");0<e.length&&(null!=(e=e.data("store"))&&store.remove(e)),Eadmin.button.reset(l.submit),i(t)},error:function(t){Eadmin.button.reset(l.submit),i(t)}}),!1}).on("keyup",".textarea-max",function(){var t=$(this),e=t.attr("maxlength"),a=t.val().length;e<a||t.next().html(a+" / "+e)})}},{key:"checkbox",value:function(t,e){var a={};1==e?(a={checked:!0,i_class:"ri-checkbox-line",class:"checkbox-checked"},2<arguments.length&&void 0!==arguments[2]&&arguments[2]?(a.i_class="ri-checkbox-indeterminate-line",t.addClass("checkbox-half")):t.removeClass("checkbox-half")):(a={checked:!1,i_class:"ri-checkbox-blank-line",class:"checkbox"},t.removeClass("checkbox-half")),t.prop("checked",a.checked).prev("i").attr("class",a.i_class).parent("label").attr("class",a.class)}},{key:"select",value:function(t){var e;0!=(e=t.find("select")).length&&e.each(function(){var t=$(this),e={txt:t.children("option:first").text(),default:t.find("option:first").val()};t.val(e.default).next().children("span").removeClass("selected").html(e.txt),t.next().next().find(".active").removeClass("active")})}},{key:"input",value:function(t){1<arguments.length&&void 0!==arguments[1]&&arguments[1]?t.removeClass("error-input"):t.addClass("error-input")}},{key:"textarea",value:function(t){1<arguments.length&&void 0!==arguments[1]&&arguments[1]?t.removeClass("error-input"):t.addClass("error-input")}}]),t}();