/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Tree=function(){function n(t,e){_classCallCheck(this,n),this.dom=scope(t),this.dom.addClass("tree"),this.data=_.cloneDeep(e.data);var a;0!=e.data.length?(function e(a,n,i){return i.filter(function(t){return t.pid===a}).forEach(function(t){t.children=e(t.id,[],i),n.push(t)}),n}(0,t=[],this.data),function n(t){_.each(t,function(t){var e=t.children.length;if(0==e)return!0;var a=_.filter(t.children,["checked",!0]).length;0<a&&a<e&&(t.half=!0),n(t.children)})}(t),this.param=$.extend({data:[],checkbox:!1,open:!1,oncheck:null,onclick:null,bind:""},e),this.input=null,this.param.data=t,this.data=e.data,""!=this.param.bind&&this.param.checkbox&&(a=[],_.each(this.data,function(t){t.checked&&a.push(t.id)}),this.dom.after('<input type="hidden" name="'+this.param.bind+'" value="'+_.join(a,",")+'">'),this.input=this.dom.next("input")),this.run()):this.dom.html('<span class="note mt20">没有树形菜单数据</span>')}return _createClass(n,[{key:"run",value:function(){this._create(),this._event()}},{key:"_create",value:function(){var h=this,o={html:""};(function i(c,t){var e=2<arguments.length&&void 0!==arguments[2]&&arguments[2],d=3<arguments.length&&void 0!==arguments[3]&&arguments[3];0<c&&(o.html+="<div",!0===e||h.param.open||(o.html+=' class="dn"'),o.html+=">"),_.each(t,function(t){var e=["",0,t.children.length],a=e[0],n=e[1],e=e[2];0==c?(0==e&&(a=' style="padding-left:20px;"'),!h.param.open&&!0!==t.open||(n=1)):(!0!==t.open&&!h.param.open||(n=1),h.param.checkbox&&(a+=' class="tree-checkbox"'),0==e&&(a+=' style="padding-left:'+(h.param.checkbox?46:38)+'px;"')),o.html+="<ul"+a+"><li>",0<e&&(o.html+='<i data-open="'+n+'" class="ri-arrow-right-s-line '+(1==n?"rotate-90":"rotate-0")+'"></i>'),h.param.checkbox?(!(n="")!==t.checked&&!0!==t.half||(n+=" checked"),!0!==t.disabled&&!0!==d||(n+=" disabled"),!0===t.half&&(n+=' class="checkbox-half"'),o.html+='<label>\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\tid="'+t.id+'" \n\t\t\t\t\t\t\t\t\t\tdata-pid="'+t.pid+'"\n\t\t\t\t\t\t\t\t\t\ttype="checkbox" \n\t\t\t\t\t\t\t\t\t\t'+n+"> "+t.name+"\n\t\t\t\t\t\t\t\t</label>"):o.html+='<span \n\t\t\t\t\t\t\t\t\tdata-tree-node="'+t.id+'" \n\t\t\t\t\t\t\t\t\t'+(h.param.checkbox?"":' class="cp"')+">"+t.name+"\n\t\t\t\t\t\t\t\t</span>",0<e&&(!0===d&&(t.disabled=d),i(c+1,t.children,t.open,t.disabled)),o.html+="</li></ul>"}),0<c&&(o.html+="</div>")})(0,this.param.data),this.dom.html(o.html)}},{key:"_event",value:function(){var t=["[data-open]",":checkbox","[data-tree-node]"],c=this;c.dom.on("click",t[0],function(){var t=[$(this),{}],e=t[0],t=t[1];if(t.open=e.data("open"),t.child=e.next().next(),0==t.open)return e.data("open",1).removeClass("rotate-0").addClass("rotate-90"),void t.child.slideDown(200);e.data("open",0).removeClass("rotate-90").addClass("rotate-0"),t.child.slideUp(200)}).on("click",t[1],function(){var t=[$(this),{}],e=t[0],a=t[1],n={checkChild:function(t){t=c.dom.find('input[data-pid="'+t+'"]:not(:disabled)');0!=t.length&&(Form.checkbox(t,a.check),t.each(function(){n.checkChild($(this).attr("id"))}))},checkParent:function(t){var e,a=c.dom.find("#"+t);0!=a.length&&(c.dom.find('input[data-pid="'+t+'"]').length==(e=c.dom.find('input[data-pid="'+t+'"]:not(.checkbox-half):checked').length)?Form.checkbox(a,!0):0!=e||0<c.dom.find('.checkbox-half[data-pid="'+t+'"]:checked').length?Form.checkbox(a,!0,!0):Form.checkbox(a,!1),a.each(function(){n.checkParent($(this).data("pid"))}))}};a.check=e.is(":checked"),a.pid=e.data("pid"),a.id=e.attr("id"),n.checkChild(a.id),n.checkParent(a.pid),a.checked=c.dom.find(":checked");var i=[];a.checked.each(function(){i.push(parseInt($(this).attr("id")))}),null!=c.input&&c.input.val(_.join(i,","));e=c.data.filter(function(t){return-1!=i.indexOf(t.id)});null!=c.param.oncheck&&c.param.oncheck(e)}),c.param.checkbox||null==c.param.onclick||c.dom.on("click",t[2],function(){var e=$(this).data("tree-node"),t=c.data.filter(function(t){return t.id===e});c.param.onclick(t[0])})}}]),n}();