/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Tree=function(){function n(t,e){_classCallCheck(this,n),this.dom=scope(t),this.dom.addClass("tree"),this.data=_.cloneDeep(e.data);if(0!=e.data.length){var a=[];!function e(a,n,c){return c.filter(function(t){return t.pid===a}).forEach(function(t){t.children=e(t.id,[],c),n.push(t)}),n}(0,a,this.data);!function n(t){_.each(t,function(t){var e=t.children.length;if(0==e)return!0;var a=_.filter(t.children,["checked",!0]).length;0<a&&a<e&&(t.half=!0),n(t.children)})}(a),this.param=$.extend({data:[],checkbox:!1,open:!1,oncheck:null,onclick:null},e),this.param.data=a,this.data=e.data,this.run()}else this.dom.html('<span class="note mt20">没有树形菜单数据</span>')}return _createClass(n,[{key:"run",value:function(){this._create(),this._event()}},{key:"_create",value:function(){var o=this,r={html:""};!function h(d,t){var e=2<arguments.length&&void 0!==arguments[2]&&arguments[2],l=3<arguments.length&&void 0!==arguments[3]&&arguments[3];0<d&&(r.html+="<div",!0===e||o.param.open||(r.html+=' class="dn"'),r.html+=">"),_.each(t,function(t){var e="",a=0,n=t.children.length;if(0==d?(0==n&&(e=' style="padding-left:20px;"'),(o.param.open||!0===t.open)&&(a=1)):((!0===t.open||o.param.open)&&(a=1),o.param.checkbox&&(e+=' class="tree-checkbox"'),0==n&&(e+=' style="padding-left:'+(o.param.checkbox?46:38)+'px;"')),r.html+="<ul"+e+"><li>",0<n){var c=1==a?"rotate-90":"rotate-0";r.html+='<i data-open="'+a+'" class="ri-arrow-right-s-line '+c+'"></i>'}if(o.param.checkbox){var i="";!0!==t.checked&&!0!==t.half||(i+=" checked"),!0!==t.disabled&&!0!==l||(i+=" disabled"),!0===t.half&&(i+=' class="checkbox-half"'),r.html+='<label>\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\tid="'+t.id+'" \n\t\t\t\t\t\t\t\t\t\tdata-pid="'+t.pid+'"\n\t\t\t\t\t\t\t\t\t\ttype="checkbox" \n\t\t\t\t\t\t\t\t\t\t'+i+"> "+t.name+"\n\t\t\t\t\t\t\t\t</label>"}else r.html+='<span \n\t\t\t\t\t\t\t\t\tdata-tree-node="'+t.id+'" \n\t\t\t\t\t\t\t\t\t'+(o.param.checkbox?"":' class="cp"')+">"+t.name+"\n\t\t\t\t\t\t\t\t</span>";0<n&&(!0===l&&(t.disabled=l),h(d+1,t.children,t.open,t.disabled)),r.html+="</li></ul>"}),0<d&&(r.html+="</div>")}(0,this.param.data),this.dom.html(r.html)}},{key:"_event",value:function(){var t=["[data-open]",":checkbox","[data-tree-node]"],i=this;i.dom.on("click",t[0],function(){var t={this:$(this)};if(t.open=t.this.data("open"),t.child=t.this.next().next(),0==t.open)return t.this.data("open",1).removeClass("rotate-0").addClass("rotate-90"),void t.child.slideDown(200);t.this.data("open",0).removeClass("rotate-90").addClass("rotate-0"),t.child.slideUp(200)}).on("click",t[1],function(){var a={this:$(this)},c={checkChild:function(t){var e=i.dom.find('input[data-pid="'+t+'"]:not(:disabled)');0!=e.length&&(Form.checkbox(e,a.check),e.each(function(){c.checkChild($(this).attr("id"))}))},checkParent:function(t){var e=i.dom.find("#"+t);if(0!=e.length){var a=i.dom.find('input[data-pid="'+t+'"]').length,n=i.dom.find('input[data-pid="'+t+'"]:not(.checkbox-half):checked').length;if(a==n)Form.checkbox(e,!0);else if(0==n){0<i.dom.find('.checkbox-half[data-pid="'+t+'"]:checked').length?Form.checkbox(e,!0,!0):Form.checkbox(e,!1)}else Form.checkbox(e,!0,!0);e.each(function(){c.checkParent($(this).data("pid"))})}}};if(a.check=a.this.is(":checked"),a.pid=a.this.data("pid"),a.id=a.this.attr("id"),c.checkChild(a.id),c.checkParent(a.pid),null!=i.param.oncheck){a.checked=i.dom.find(":checked");var e=[];a.checked.each(function(){e.push(parseInt($(this).attr("id")))});var t=i.data.filter(function(t){return-1!=e.indexOf(t.id)});null!=i.param.oncheck&&i.param.oncheck(t)}}),i.param.checkbox||null==i.param.onclick||i.dom.on("click",t[2],function(){var e=$(this).data("tree-node"),t=i.data.filter(function(t){return t.id===e});i.param.onclick(t[0])})}}]),n}();