/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,a){return e&&n(t.prototype,e),a&&n(t,a),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Tree=function(){function i(t,e){_classCallCheck(this,i),this.dom=scope(t),this.dom.addClass("tree"),this.data=_.cloneDeep(e.data);if(0!=e.data.length){var a=[];!function e(a,n,i){return i.filter(function(t){return t.pid===a}).forEach(function(t){t.children=e(t.id,[],i),n.push(t)}),n}(0,a,this.data);if(function n(t){_.each(t,function(t){var e=t.children.length;if(0==e)return!0;var a=_.filter(t.children,["checked",!0]).length;0<a&&a<e&&(t.half=!0),n(t.children)})}(a),this.param=$.extend({data:[],checkbox:!1,open:!1,oncheck:null,onclick:null,bind:""},e),this.input=null,this.param.data=a,this.data=e.data,""!=this.param.bind&&this.param.checkbox){var n=[];_.each(this.data,function(t){t.checked&&n.push(t.id)}),this.dom.after('<input type="hidden" name="'+this.param.bind+'" value="'+_.join(n,",")+'">'),this.input=this.dom.next("input")}this.run()}else this.dom.html('<span class="note mt20">没有树形菜单数据</span>')}return _createClass(i,[{key:"run",value:function(){this._create(),this._event()}},{key:"_create",value:function(){var r=this,s={html:""};!function h(l,t){var e=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o=3<arguments.length&&void 0!==arguments[3]&&arguments[3];0<l&&(s.html+="<div",!0===e||r.param.open||(s.html+=' class="dn"'),s.html+=">"),_.each(t,function(t){var e=["",0,t.children.length],a=e[0],n=e[1],i=e[2];if(0==l?(0==i&&(a=' style="padding-left:20px;"'),(r.param.open||!0===t.open)&&(n=1)):((!0===t.open||r.param.open)&&(n=1),r.param.checkbox&&(a+=' class="tree-checkbox"'),0==i&&(a+=' style="padding-left:'+(r.param.checkbox?46:38)+'px;"')),s.html+="<ul"+a+"><li>",0<i){var c=1==n?"rotate-90":"rotate-0";s.html+='<i data-open="'+n+'" class="ri-arrow-right-s-line '+c+'"></i>'}if(r.param.checkbox){var d="";!0!==t.checked&&!0!==t.half||(d+=" checked"),!0!==t.disabled&&!0!==o||(d+=" disabled"),!0===t.half&&(d+=' class="checkbox-half"'),s.html+='<label>\n\t\t\t\t\t\t\t\t\t<input \n\t\t\t\t\t\t\t\t\t\tid="'+t.id+'" \n\t\t\t\t\t\t\t\t\t\tdata-pid="'+t.pid+'"\n\t\t\t\t\t\t\t\t\t\ttype="checkbox" \n\t\t\t\t\t\t\t\t\t\t'+d+"> "+t.name+"\n\t\t\t\t\t\t\t\t</label>"}else s.html+='<span \n\t\t\t\t\t\t\t\t\tdata-tree-node="'+t.id+'" \n\t\t\t\t\t\t\t\t\t'+(r.param.checkbox?"":' class="cp"')+">"+t.name+"\n\t\t\t\t\t\t\t\t</span>";0<i&&(!0===o&&(t.disabled=o),h(l+1,t.children,t.open,t.disabled)),s.html+="</li></ul>"}),0<l&&(s.html+="</div>")}(0,this.param.data),this.dom.html(s.html)}},{key:"_event",value:function(){var t=["[data-open]",":checkbox","[data-tree-node]"],d=this;d.dom.on("click",t[0],function(){var t=[$(this),{}],e=t[0],a=t[1];if(a.open=e.data("open"),a.child=e.next().next(),0==a.open)return e.data("open",1).removeClass("rotate-0").addClass("rotate-90"),void a.child.slideDown(200);e.data("open",0).removeClass("rotate-90").addClass("rotate-0"),a.child.slideUp(200)}).on("click",t[1],function(){var t=[$(this),{}],e=t[0],a=t[1],i={checkChild:function(t){var e=d.dom.find('input[data-pid="'+t+'"]:not(:disabled)');0!=e.length&&(Form.checkbox(e,a.check),e.each(function(){i.checkChild($(this).attr("id"))}))},checkParent:function(t){var e=d.dom.find("#"+t);if(0!=e.length){var a=d.dom.find('input[data-pid="'+t+'"]').length,n=d.dom.find('input[data-pid="'+t+'"]:not(.checkbox-half):checked').length;if(a==n)Form.checkbox(e,!0);else if(0==n){0<d.dom.find('.checkbox-half[data-pid="'+t+'"]:checked').length?Form.checkbox(e,!0,!0):Form.checkbox(e,!1)}else Form.checkbox(e,!0,!0);e.each(function(){i.checkParent($(this).data("pid"))})}}};a.check=e.is(":checked"),a.pid=e.data("pid"),a.id=e.attr("id"),i.checkChild(a.id),i.checkParent(a.pid),a.checked=d.dom.find(":checked");var n=[];a.checked.each(function(){n.push(parseInt($(this).attr("id")))}),null!=d.input&&d.input.val(_.join(n,","));var c=d.data.filter(function(t){return-1!=n.indexOf(t.id)});null!=d.param.oncheck&&d.param.oncheck(c)}),d.param.checkbox||null==d.param.onclick||d.dom.on("click",t[2],function(){var e=$(this).data("tree-node"),t=d.data.filter(function(t){return t.id===e});d.param.onclick(t[0])})}}]),i}();